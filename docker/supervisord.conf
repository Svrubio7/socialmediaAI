[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/run/supervisord.pid
user=root

[program:fastapi]
directory=/srv/backend
command=/opt/venv/bin/gunicorn app.main:app -k uvicorn.workers.UvicornWorker -w 1 -b 127.0.0.1:%(ENV_FASTAPI_PORT)s --access-logfile - --error-logfile -
autostart=true
autorestart=true
startsecs=5
priority=30
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=PYTHONPATH="/srv/backend",PORT="%(ENV_FASTAPI_PORT)s"

[program:nuxt]
directory=/srv/frontend
command=/usr/local/bin/node /srv/frontend/.output/server/index.mjs
autostart=true
autorestart=true
startsecs=5
priority=20
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=HOST="127.0.0.1",PORT="%(ENV_NUXT_PORT)s",NODE_ENV="production",NUXT_PUBLIC_SUPABASE_KEY="%(ENV_NUXT_PUBLIC_SUPABASE_ANON_KEY)s"

[program:elevo-editor]
directory=/srv/elevo-editor
command=/usr/local/bin/node /srv/elevo-editor/apps/web/server.js
autostart=true
autorestart=true
startsecs=5
priority=20
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=HOSTNAME="127.0.0.1",PORT="%(ENV_ELEVO_EDITOR_PORT)s",NODE_ENV="production",NEXT_PUBLIC_FASTAPI_URL="%(ENV_NEXT_PUBLIC_FASTAPI_URL)s",NEXT_PUBLIC_EDITOR_BASE_PATH="%(ENV_NEXT_PUBLIC_EDITOR_BASE_PATH)s",NEXT_PUBLIC_EDITOR_RETURN_TO="%(ENV_NEXT_PUBLIC_EDITOR_RETURN_TO)s",NEXT_PUBLIC_EDITOR_DIAGNOSTICS="%(ENV_NEXT_PUBLIC_EDITOR_DIAGNOSTICS)s",NEXT_PUBLIC_SUPABASE_URL="%(ENV_NEXT_PUBLIC_SUPABASE_URL)s",NEXT_PUBLIC_SUPABASE_ANON_KEY="%(ENV_NEXT_PUBLIC_SUPABASE_ANON_KEY)s",NEXT_PUBLIC_SUPABASE_STORAGE_BUCKET="%(ENV_NEXT_PUBLIC_SUPABASE_STORAGE_BUCKET)s"

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
startsecs=3
priority=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
